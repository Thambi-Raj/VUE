<!DOCTYPE HTML>
<html>

<head>
    <style>
        #div1,
        #div2 {
            float: left;
            width: 100px;
            height: 35px;
            margin: 10px;
            padding: 10px;
            border: 1px solid black;
        }

        .flex {
            display: flex;
        }
    </style>
    <script>
        function allowDrop(ev) {
            ev.preventDefault();
        }
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            draggedElement.setAttribute('class', 'dragged');
        }
        function drop(ev) {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            var draggedElement = document.getElementById(data);
            var topOffset = ev.clientY;
            var body_content = document.querySelector('body').children;
            var clone = [...body_content];
            var match_content = [];
            var ind = -1;
            for (var i = 0; i < body_content.length; i++) {
                var pos = body_content[i].getBoundingClientRect();
                var element_position = pos.y + pos.height;
                if (draggedElement.parentElement == body_content[i]) {
                    var child = draggedElement.parentElement.children[0];
                    for (var j = 0; j < child.children.length; j++) {
                        var posi = child.children[j].getBoundingClientRect();
                        var ele_posi = posi.y + posi.height
                        if ((ele_posi >= topOffset && (topOffset + draggedElement.clientHeight) >= ele_posi)) {
                            match_content.push(i + "-" + j);
                        }
                    }
                    ind = i;
                }
               
                else if ((element_position >= topOffset && (topOffset + draggedElement.clientHeight) >= element_position) && body_content[i].tagName.toLocaleLowerCase() != 'div') {
                    match_content.push(i);
                }
            }
            var flex_div = document.createElement('div');
            var flex_child = document.createElement('div');
            var replace_body = document.createElement('div');
            flex_div.setAttribute('class', 'flex');
            var b = true;
            var result = [];
            if (match_content.length != 0) {
                for (var i = 0; i < clone.length; i++) {
                    if (clone[i] != draggedElement) {
                        if (match_content.includes(i)) {
                            flex_child.append(clone[i].cloneNode(true));
                        }
                        else if (ind == i) {
                            var child = clone[i].children[0];
                            for (var j = 0; j < child.children.length; j++) {
                                var str_chk = i + "-" + j;
                                if (match_content.includes(str_chk)) {
                                    flex_child.append(child.children[j].cloneNode(true));
                                }
                                else {
                                    flex_child.innerHTML != '' ?
                                        (flex_div.appendChild(flex_child.cloneNode(true)), flex_div.appendChild(draggedElement), result.push(flex_div)) : '';
                                    flex_child.innerHTML = '';
                                    result.push(child.children[j].cloneNode(true));
                                }
                            }
                        }
                        else {
                            var temp = clone[i].cloneNode(true);
                            flex_child.innerHTML != '' ?
                                (flex_div.append(flex_child.cloneNode(true)), flex_div.appendChild(draggedElement), result.push(flex_div.cloneNode(true))) : '';
                            flex_child.innerHTML = '';

                            result.push(temp);
                        }
                    }

                }
                flex_child.innerHTML != '' ?
                    (flex_div.append(flex_child.cloneNode(true)), flex_div.appendChild(draggedElement), result.push(flex_div)) : '';
                flex_child.innerHTML = '';
                var body = document.querySelector('body');
                body.innerHTML = '';
                for (let index = 0; index < result.length; index++) {

                    body.append(result[index].cloneNode(true));
                }
            }
            else{
                alert('invalid posi')
            }
        }

    </script>
</head>

<body ondrop="drop(event)" ondragover="allowDrop(event)"  contenteditable="true">
    <h2>a</h2>
    <p>b</p>
    <p>c</p>
    <p>d</p>
    <p>e</p>
    <p>f</p>
    <p>g</p>
    <img src="texture1.jpg" draggable="true" ondragstart="drag(event)" id="drag1" width="100" height="100">
    <p>h</p>
    <p>i</p>
    <img src="texture1.jpg" draggable="true" ondragstart="drag(event)" id="drag2" width="100" height="100">
    <p>j</p>
    <p>ld,sl,lsd</p>
    <p>sdlsld</p>
    <p>slsdl,</p>
    <p>k</p>
</body>

</html>